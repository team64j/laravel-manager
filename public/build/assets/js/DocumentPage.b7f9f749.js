import{_ as r,a as h}from"../app.ca983809.js";import"./vue.c7926159.js";import{c as l,aM as c,o as d}from"./@vue.21d3b485.js";import"./vue-codemirror.f710c5d3.js";import"./codemirror.65c2c8aa.js";import"./@codemirror.86619810.js";import"./@lezer.13b71bd8.js";import"./crelt.2ca95e67.js";import"./style-mod.dd020e09.js";import"./w3c-keyname.f0bedd1c.js";import"./vuedraggable.6704fbca.js";import"./axios.49d3df40.js";import"./sortablejs.8b43ee28.js";import"./lodash.009183e4.js";import"./@kyvg.9e3dee5d.js";import"./vue-router.5d347134.js";import"./vuex.7e60e04e.js";const u={name:"DocumentPage",components:{Layout:h},props:{currentRoute:Object},data(){return{data:null,meta:null,layout:null}},computed:{id(){return this.data?.id||this.currentRoute.params&&this.currentRoute.params.id||null},title(){return this.data?.pagetitle||this.data?.id&&"..."||this.$root.lang("new_resource")}},created(){this.$emit("action","setTab",{key:this._.vnode.key,meta:{title:"..."},changed:!1,loading:!0}),this.get()},methods:{action(){typeof this[arguments[0]]=="function"?this[arguments[0]](...Array.from(arguments).splice(1)):this.$emit("action",...arguments)},get(){axios.get("api/document/"+this.id).then(t=>{this.data=t.data.data,this.meta=t.data.meta,this.layout=t.data.layout,this.$emit("action","setTab",{key:this._.vnode.key,meta:{title:this.title},changed:!1,loading:!1}),this.$watch(()=>this.data,()=>{this.$emit("action","setTab",{key:this._.vnode.key,changed:!0})},{deep:!0})})},save(t){this.$emit("action","setTab",{key:this._.vnode.key,changed:!1,loading:!0}),this.data.id?axios.patch("api/document/"+this.data.id,this.data).then(e=>this.afterSave(e,t)):axios.post("api/document",this.data).then(e=>this.afterSave(e,t))},afterSave(t,e){switch(this.data=t.data.data,this.meta=t.data.meta,this.layout=t.data.layout,this.$store.dispatch("set",{tree:{id:"treeDocuments",action:"updateNode",params:this.data}}),this.$store.dispatch("set",{saving:!1}),this.$nextTick(()=>this.$emit("action","setTab",{key:this._.vnode.key,changed:!1,loading:!1})),e){case 0:this.$emit("action","closeTab");break;case 1:this.$emit("action","toTab",{name:"Document",params:{id:null}});break;default:this.$nextTick(()=>this.$emit("action","setTab",{key:this._.vnode.key,meta:{title:this.title}}))}},delete(){confirm("OK ?")},cancel(){this.$emit("action","closeTab")},view(){window.open(this.meta.url,"_blank")},changeFormSelect(t,e){console.log(e._.vnode.key)},"update:modelValue"(t,e,i,a,s){},"mousedown:input"(t,e){const i=t.target;e._.vnode.key==="parent"&&this.selectParent(i,e)},selectParent(t,e){const i=this.$root.lang("new_parent");t.dataset.value||(t.dataset.value=t.value),t.value===i?this.setParent(t):(this.setParent(t,i),this.$store.getters["Config/get"]("treeSelectNode")||this.$store.dispatch("Config/set",{treeSelectNode:{}}),this.uw||(this.uw=this.$watch(()=>this.$store.state.Config.treeSelectNode,async a=>{if(this.$store.dispatch("Config/set",{treeSelectNode:!1}),this.uw(),this.uw=null,!a){await this.setParent(t);return}a.loading=!0,t.disabled=!0;const s=await axios.get("api/document/parents/"+a.id).then(o=>o.data.data)||[];this.data.id===a.id||this.data.id===a.parent||s.some(o=>o.id===this.data.id)?(this.$notify({text:this.$root.lang("unable_set_parent"),type:"error"}),await this.setParent(t)):a&&(e.model=a.id,await this.setParent(t,a.pagetitle+" ("+a.id+")")),a.loading=!1,t.disabled=!1})))},setParent(t,e){e?this.$nextTick(()=>t.value=e):this.$nextTick(()=>t.value=t.dataset.value)}}};function m(t,e,i,a,s,o){const n=c("layout");return d(),l(n,{data:s.data,meta:s.meta,layout:s.layout,onAction:o.action,"current-route":i.currentRoute},null,8,["data","meta","layout","onAction","current-route"])}const R=r(u,[["render",m]]);export{R as default};
