import{_ as n,a as m}from"../app.ca983809.js";import"./vue.c7926159.js";import{c as h,aM as l,o as u}from"./@vue.21d3b485.js";import"./vue-codemirror.f710c5d3.js";import"./codemirror.65c2c8aa.js";import"./@codemirror.86619810.js";import"./@lezer.13b71bd8.js";import"./crelt.2ca95e67.js";import"./style-mod.dd020e09.js";import"./w3c-keyname.f0bedd1c.js";import"./vuedraggable.6704fbca.js";import"./axios.49d3df40.js";import"./sortablejs.8b43ee28.js";import"./lodash.009183e4.js";import"./@kyvg.9e3dee5d.js";import"./vue-router.5d347134.js";import"./vuex.7e60e04e.js";const c={name:"TemplatePage",components:{Layout:m},props:{currentRoute:Object},data(){return{data:null,meta:null,layout:null}},computed:{id(){return this.data?.id||this.currentRoute.params&&this.currentRoute?.params.id||null},title(){return this.data?.templatename||this.data?.id&&"..."||this.$root.lang("new_template")}},created(){this.$emit("action","setTab",{key:this._.vnode.key,meta:{title:"..."},changed:!1}),this.get()},methods:{action(){typeof this[arguments[0]]=="function"?this[arguments[0]](...Array.from(arguments).splice(1)):this.$emit("action",...arguments)},"mousedown:select"(t,e){},"update:modelValue"(t,e,a,s,i){},get(){axios.get("api/template/"+this.id,{params:this.currentRoute.query||null}).then(t=>{this.data=t.data.data,this.meta=t.data.meta,this.layout=t.data.layout,this.$emit("action","setTab",{key:this._.vnode.key,meta:{title:this.title},changed:!1}),this.$watch(()=>this.data,()=>{this.$emit("action","setTab",{key:this._.vnode.key,changed:!0})},{deep:!0})})},save(t){this.$emit("action","setTab",{key:this._.vnode.key,changed:!1}),this.meta=null,this.data.id?axios.patch("api/template/"+this.data.id,this.data).then(e=>this.afterSave(e,t)):axios.post("api/template",this.data).then(e=>this.afterSave(e,t))},afterSave(t,e){switch(this.data=t.data.data,this.meta=t.data.meta,this.layout=t.data.layout,this.$store.dispatch("set",{tree:{id:"treeTemplates",action:"updateNode",params:this.data}}),this.$nextTick(()=>{this.$emit("action","setTab",{key:this._.vnode.key,changed:!1}),this.$store.dispatch("set",{stay:e,saving:!1})}),e){case 0:this.$emit("action","toTab",{name:"Elements",params:{element:"templates"}});break;case 1:this.$emit("action","toTab",{name:"Template",params:{id:null}});break}},cancel(){this.$emit("action","toTab",{name:"Elements",params:{element:"templates"}})},filter(t){if(!t||t.length>1){const e=this.$router.resolve(t?"?filter="+t:"");this.$router.push(e),this.meta={tvs:{filter:this.meta?.tvs?.filter}},axios.get("api/template/"+this.id,{params:e.query||null}).then(a=>{this.meta=a.data.meta})}},pagination(t){const e=this.$router.resolve("?"+t);this.$router.push(e),this.meta={tvs:{filter:this.meta?.tvs?.filter}},axios.get("api/template/"+this.id,{params:e.query||null}).then(a=>{this.meta=a.data.meta})},sort(t,e){const a=this.$router.resolve("?order="+t+"&dir="+e);this.$router.push(a),this.meta={tvs:{filter:this.meta?.tvs?.filter}},axios.get("api/template/"+this.id,{params:a.query||null}).then(s=>{this.meta=s.data.meta})},attach(t){t.attach=t.attach?0:1;const e=this.data.tvs.indexOf(t.id);t.attach?!(e>-1)&&this.data.tvs.push(t.id):e>-1&&this.data.tvs.splice(e,1)}}};function d(t,e,a,s,i,o){const r=l("layout");return u(),h(r,{data:i.data,meta:i.meta,layout:i.layout,onAction:o.action,"current-route":a.currentRoute},null,8,["data","meta","layout","onAction","current-route"])}const E=n(c,[["render",d]]);export{E as default};
